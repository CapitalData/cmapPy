

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cmapPy.pandasGEXpress.concat_gctoo &mdash; cmapPy 1.0.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="cmapPy 1.0.2 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> cmapPy
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../build.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../clue_api_client.html">Clue API Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pandasGEXpress.html">pandasGEXpress</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contribution guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../licenses.html">BSD 3-Clause License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citing.html">Citation Information</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">cmapPy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>cmapPy.pandasGEXpress.concat_gctoo</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cmapPy.pandasGEXpress.concat_gctoo</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">concat_gctoo.py</span>

<span class="sd">This function is for concatenating gct(x) files together. You can tell it to</span>
<span class="sd">find files using the file_wildcard argument, or you can tell it exactly</span>
<span class="sd">which files you want to concatenate using the input_filepaths argument. The</span>
<span class="sd">meat of this function are the hstack (i.e. horizontal concatenation of GCToo objects)</span>
<span class="sd">and vstack (i.e. vertical concatenation).</span>

<span class="sd">Terminology: &#39;Common&#39; metadata refers to the metadata that is shared between</span>
<span class="sd">the loaded GCToo&#39;s. For example, if horizontally concatenating, the &#39;common&#39; metadata is</span>
<span class="sd">the row metadata. &#39;Concatenated&#39; metadata is the other one; it&#39;s the metadata</span>
<span class="sd">for the entries being concatenated together. For example, if horizontally</span>
<span class="sd">concatenating, the &#39;concatenated&#39; metadata is the column metadata because</span>
<span class="sd">columns are being concatenated together.</span>

<span class="sd">There are 2 arguments that allow you to work around certain obstacles</span>
<span class="sd">of concatenation.</span>

<span class="sd">1) If the &#39;common&#39; metadata contains fields that are not the same in</span>
<span class="sd">all files, then you will need to remove these fields using the</span>
<span class="sd">fields_to_remove argument.</span>

<span class="sd">2) If the &#39;concatenated&#39; metadata ids are not unique between different files,</span>
<span class="sd">and you try to concatenate the files, an invalid GCToo would be formed</span>
<span class="sd">(duplicate ids). To overcome this, use the reset_sample_ids argument. This will</span>
<span class="sd">move the &#39;new&#39; metadata ids to a new metadata field and replace the original ids</span>
<span class="sd">with unique integers.</span>

<span class="sd">N.B. This script sorts everything!</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">setup_GCToo_logger</span> <span class="k">as</span> <span class="nn">setup_logger</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">GCToo</span>
<span class="kn">import</span> <span class="nn">parse</span> 
<span class="kn">import</span> <span class="nn">write_gct</span>
<span class="kn">import</span> <span class="nn">write_gctx</span> 

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Lev Litichevskiy&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;lev@broadinstitute.org&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">setup_logger</span><span class="o">.</span><span class="n">LOGGER_NAME</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">build_parser</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">)</span>

    <span class="c1"># Required args</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--concat_direction&quot;</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;horiz&quot;</span><span class="p">,</span> <span class="s2">&quot;vert&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;which direction to concatenate&quot;</span><span class="p">)</span>

    <span class="n">mutually_exclusive_group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
    <span class="n">mutually_exclusive_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--input_filepaths&quot;</span><span class="p">,</span> <span class="s2">&quot;-if&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;full paths to gct(x) files to be concatenated&quot;</span><span class="p">)</span>
    <span class="n">mutually_exclusive_group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--file_wildcard&quot;</span><span class="p">,</span> <span class="s2">&quot;-w&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;wildcard specifying where files should be found &quot;</span> <span class="o">+</span>
              <span class="s2">&quot;(make sure to surround in quotes if calling from command line!)&quot;</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--out_type&quot;</span><span class="p">,</span> <span class="s2">&quot;-ot&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;gctx&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gct&quot;</span><span class="p">,</span> <span class="s2">&quot;gctx&quot;</span><span class="p">],</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to save output as a gct or gctx&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--out_name&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;concated.gctx&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;what to name the output file&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fields_to_remove&quot;</span><span class="p">,</span> <span class="s2">&quot;-ftr&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;fields to remove from the common metadata&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--reset_ids&quot;</span><span class="p">,</span> <span class="s2">&quot;-rsi&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to reset ids (use this flag if ids are not unique)&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-data_null&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;NaN&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;how to represent missing values in the data&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-metadata_null&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;-666&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;how to represent missing values in the metadata&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-filler_null&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;-666&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;what value to use for filling the top-left filler block if output is a .gct&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;-verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;whether to print a bunch of output&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>

    <span class="c1"># Get files directly</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">input_filepaths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">input_filepaths</span>

    <span class="c1"># Or find them</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">get_file_list</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file_wildcard</span><span class="p">)</span>
        
        <span class="c1"># No files found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No files were found. args.file_wildcard: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">file_wildcard</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Only 1 file found</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Only 1 file found. No concatenation needs to be done, exiting&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># More than 1 file found</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Parse each file and append to a list</span>
        <span class="n">gctoos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">gctoos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parse</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

        <span class="c1"># Create concatenated gctoo object</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;horiz&quot;</span><span class="p">:</span>
            <span class="n">out_gctoo</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">(</span><span class="n">gctoos</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">fields_to_remove</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">reset_ids</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;vert&quot;</span><span class="p">:</span>
            <span class="n">out_gctoo</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">(</span><span class="n">gctoos</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">fields_to_remove</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">reset_ids</span><span class="p">)</span>

    <span class="c1"># Write out_gctoo to file</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing to output file args.out_name:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">out_name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">out_type</span> <span class="o">==</span> <span class="s2">&quot;gctx&quot;</span><span class="p">:</span>
        <span class="n">write_gctx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_gctoo</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">out_type</span> <span class="o">==</span> <span class="s2">&quot;gct&quot;</span><span class="p">:</span>
        <span class="n">write_gct</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_gctoo</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_name</span><span class="p">,</span>
                          <span class="n">filler_null</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">filler_null</span><span class="p">,</span>
                          <span class="n">metadata_null</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">metadata_null</span><span class="p">,</span>
                          <span class="n">data_null</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">data_null</span><span class="p">)</span>


<div class="viewcode-block" id="get_file_list"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.get_file_list">[docs]</a><span class="k">def</span> <span class="nf">get_file_list</span><span class="p">(</span><span class="n">wildcard</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Search for files to be concatenated. Currently very basic, but could</span>
<span class="sd">    expand to be more sophisticated.</span>

<span class="sd">    Args:</span>
<span class="sd">        wildcard (regular expression string)</span>

<span class="sd">    Returns:</span>
<span class="sd">        files (list of full file paths)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">wildcard</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">files</span></div>


<div class="viewcode-block" id="hstack"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.hstack">[docs]</a><span class="k">def</span> <span class="nf">hstack</span><span class="p">(</span><span class="n">gctoos</span><span class="p">,</span> <span class="n">fields_to_remove</span><span class="o">=</span><span class="p">[],</span> <span class="n">reset_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Horizontally concatenate gctoos.</span>

<span class="sd">    Args:</span>
<span class="sd">        gctoos (list of gctoo objects)</span>
<span class="sd">        fields_to_remove (list of strings): fields to be removed from the</span>
<span class="sd">            common metadata because they don&#39;t agree across files</span>
<span class="sd">        reset_ids (bool): set to True if sample ids are not unique</span>

<span class="sd">    Return:</span>
<span class="sd">        concated (gctoo object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Separate each gctoo into its component dfs</span>
    <span class="n">row_meta_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">col_meta_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gctoos</span><span class="p">:</span>
        <span class="n">row_meta_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">row_metadata_df</span><span class="p">)</span>
        <span class="n">col_meta_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">col_metadata_df</span><span class="p">)</span>
        <span class="n">data_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">data_df</span><span class="p">)</span>

    <span class="c1"># Concatenate row metadata</span>
    <span class="n">all_row_metadata_df</span> <span class="o">=</span> <span class="n">assemble_common_meta</span><span class="p">(</span><span class="n">row_meta_dfs</span><span class="p">,</span> <span class="n">fields_to_remove</span><span class="p">)</span>

    <span class="c1"># Concatenate col metadata</span>
    <span class="n">all_col_metadata_df</span> <span class="o">=</span> <span class="n">assemble_concatenated_meta</span><span class="p">(</span><span class="n">col_meta_dfs</span><span class="p">)</span>

    <span class="c1"># Concatenate the data_dfs</span>
    <span class="n">all_data_df</span> <span class="o">=</span> <span class="n">assemble_data</span><span class="p">(</span><span class="n">data_dfs</span><span class="p">,</span> <span class="s2">&quot;horiz&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure df shapes are correct</span>
    <span class="k">assert</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_row_metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Number of rows is incorrect.&quot;</span>
    <span class="k">assert</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_col_metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Number of columns is incorrect.&quot;</span>
    
    <span class="c1"># If requested, reset sample ids to be unique integers and move old sample</span>
    <span class="c1"># ids into column metadata</span>
    <span class="k">if</span> <span class="n">reset_ids</span><span class="p">:</span>
        <span class="n">do_reset_ids</span><span class="p">(</span><span class="n">all_col_metadata_df</span><span class="p">,</span> <span class="n">all_data_df</span><span class="p">,</span> <span class="s2">&quot;horiz&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Build GCToo of all...&quot;</span><span class="p">)</span>
    <span class="n">concated</span> <span class="o">=</span> <span class="n">GCToo</span><span class="o">.</span><span class="n">GCToo</span><span class="p">(</span><span class="n">row_metadata_df</span><span class="o">=</span><span class="n">all_row_metadata_df</span><span class="p">,</span>
                           <span class="n">col_metadata_df</span><span class="o">=</span><span class="n">all_col_metadata_df</span><span class="p">,</span>
                           <span class="n">data_df</span><span class="o">=</span><span class="n">all_data_df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">concated</span></div>


<div class="viewcode-block" id="vstack"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.vstack">[docs]</a><span class="k">def</span> <span class="nf">vstack</span><span class="p">(</span><span class="n">gctoos</span><span class="p">,</span> <span class="n">fields_to_remove</span><span class="o">=</span><span class="p">[],</span> <span class="n">reset_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Vertically concatenate gctoos.</span>

<span class="sd">    Args:</span>
<span class="sd">        gctoos (list of gctoo objects)</span>
<span class="sd">        fields_to_remove (list of strings): fields to be removed from the</span>
<span class="sd">            common metadata because they don&#39;t agree across files</span>
<span class="sd">        reset_ids (bool): set to True if row ids are not unique</span>

<span class="sd">    Return:</span>
<span class="sd">        concated (gctoo object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Separate each gctoo into its component dfs</span>
    <span class="n">row_meta_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">col_meta_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gctoos</span><span class="p">:</span>
        <span class="n">row_meta_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">row_metadata_df</span><span class="p">)</span>
        <span class="n">col_meta_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">col_metadata_df</span><span class="p">)</span>
        <span class="n">data_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">data_df</span><span class="p">)</span>

    <span class="c1"># Concatenate col metadata</span>
    <span class="n">all_col_metadata_df</span> <span class="o">=</span> <span class="n">assemble_common_meta</span><span class="p">(</span><span class="n">col_meta_dfs</span><span class="p">,</span> <span class="n">fields_to_remove</span><span class="p">)</span>

    <span class="c1"># Concatenate col metadata</span>
    <span class="n">all_row_metadata_df</span> <span class="o">=</span> <span class="n">assemble_concatenated_meta</span><span class="p">(</span><span class="n">row_meta_dfs</span><span class="p">)</span>

    <span class="c1"># Concatenate the data_dfs</span>
    <span class="n">all_data_df</span> <span class="o">=</span> <span class="n">assemble_data</span><span class="p">(</span><span class="n">data_dfs</span><span class="p">,</span> <span class="s2">&quot;vert&quot;</span><span class="p">)</span>

    <span class="c1"># Make sure df shapes are correct</span>
    <span class="k">assert</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_row_metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Number of rows is incorrect.&quot;</span>
    <span class="k">assert</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">all_col_metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Number of columns is incorrect.&quot;</span>

    <span class="c1"># If requested, reset sample ids to be unique integers and move old sample</span>
    <span class="c1"># ids into column metadata</span>
    <span class="k">if</span> <span class="n">reset_ids</span><span class="p">:</span>
        <span class="n">do_reset_ids</span><span class="p">(</span><span class="n">all_row_metadata_df</span><span class="p">,</span> <span class="n">all_data_df</span><span class="p">,</span> <span class="s2">&quot;vert&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Build GCToo of all...&quot;</span><span class="p">)</span>
    <span class="n">concated</span> <span class="o">=</span> <span class="n">GCToo</span><span class="o">.</span><span class="n">GCToo</span><span class="p">(</span><span class="n">row_metadata_df</span><span class="o">=</span><span class="n">all_row_metadata_df</span><span class="p">,</span>
                           <span class="n">col_metadata_df</span><span class="o">=</span><span class="n">all_col_metadata_df</span><span class="p">,</span>
                           <span class="n">data_df</span><span class="o">=</span><span class="n">all_data_df</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">concated</span></div>


<div class="viewcode-block" id="assemble_common_meta"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.assemble_common_meta">[docs]</a><span class="k">def</span> <span class="nf">assemble_common_meta</span><span class="p">(</span><span class="n">common_meta_dfs</span><span class="p">,</span> <span class="n">fields_to_remove</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Assemble the common metadata dfs together. Both indices are sorted.</span>

<span class="sd">    Args:</span>
<span class="sd">        common_meta_dfs (list of pandas dfs)</span>
<span class="sd">        fields_to_remove (list of strings): fields to be removed from the</span>
<span class="sd">            common metadata because they don&#39;t agree across files</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_meta_df_sorted (pandas df)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Remove any column headers that will prevent dfs from being identical</span>
    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">common_meta_dfs</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">fields_to_remove</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove any column headers that are not present in all dfs (and sort)</span>
    <span class="n">shared_column_headers</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">common_meta_dfs</span><span class="p">]))</span>
    <span class="n">common_meta_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">shared_column_headers</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">common_meta_dfs</span><span class="p">]</span>

    <span class="c1"># Concatenate all dfs and then remove duplicate rows</span>
    <span class="n">all_meta_df_with_dups</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">common_meta_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># If all metadata dfs were empty, df will be empty</span>
    <span class="k">if</span> <span class="n">all_meta_df_with_dups</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

        <span class="c1"># Simply return unique ids</span>
        <span class="n">all_meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">all_meta_df_with_dups</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_meta_df</span> <span class="o">=</span> <span class="n">all_meta_df_with_dups</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;all_meta_df_with_dups.shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_meta_df_with_dups</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;all_meta_df.shape: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_meta_df</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="c1"># If there are still duplicate ids, then their metadata didn&#39;t align</span>
    <span class="c1"># in different gcts</span>
    <span class="n">duplicate_ids</span> <span class="o">=</span> <span class="n">all_meta_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">all_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="k">assert</span> <span class="n">all_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_unique</span><span class="p">,</span> <span class="p">(</span>
        <span class="p">(</span><span class="s2">&quot;There are inconsistencies in common_metadata_df between &quot;</span> <span class="o">+</span>
         <span class="s2">&quot;different files.</span><span class="se">\n</span><span class="s2">Try excluding metadata fields &quot;</span> <span class="o">+</span>
         <span class="s2">&quot;using the fields_to_remove argument.</span><span class="se">\n</span><span class="s2">&quot;</span>
         <span class="s2">&quot;duplicate_ids[0]: </span><span class="si">{id}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
         <span class="s2">&quot;all_meta_df.loc[</span><span class="si">{id}</span><span class="s2">, :]:</span><span class="se">\n</span><span class="si">{df}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">duplicate_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">df</span><span class="o">=</span><span class="n">all_meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">duplicate_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]))</span>

    <span class="c1"># Finally, sort the index</span>
    <span class="n">all_meta_df_sorted</span> <span class="o">=</span> <span class="n">all_meta_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_meta_df_sorted</span></div>


<div class="viewcode-block" id="assemble_concatenated_meta"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.assemble_concatenated_meta">[docs]</a><span class="k">def</span> <span class="nf">assemble_concatenated_meta</span><span class="p">(</span><span class="n">concated_meta_dfs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Assemble the concatenated metadata dfs together. For example,</span>
<span class="sd">    if horizontally concatenating, the concatenated metadata dfs are the</span>
<span class="sd">    column metadata dfs. Both indices are sorted.</span>

<span class="sd">    Args:</span>
<span class="sd">        concated_meta_dfs (list of pandas dfs)</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_concated_meta_df_sorted (pandas df)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Concatenate the concated_meta_dfs</span>
    <span class="n">all_concated_meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">concated_meta_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Sanity check: the number of rows in all_concated_meta_df should correspond</span>
    <span class="c1"># to the sum of the number of rows in the input dfs</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">all_concated_meta_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;all_concated_meta_df.shape[0]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_rows</span><span class="p">))</span>
    <span class="n">n_rows_cumulative</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">concated_meta_dfs</span><span class="p">])</span>
    <span class="k">assert</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="n">n_rows_cumulative</span>

    <span class="c1"># Sort the index and columns</span>
    <span class="n">all_concated_meta_df_sorted</span> <span class="o">=</span> <span class="n">all_concated_meta_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_concated_meta_df_sorted</span></div>


<div class="viewcode-block" id="assemble_data"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.assemble_data">[docs]</a><span class="k">def</span> <span class="nf">assemble_data</span><span class="p">(</span><span class="n">data_dfs</span><span class="p">,</span> <span class="n">concat_direction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Assemble the data dfs together. Both indices are sorted.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_dfs (list of pandas dfs)</span>
<span class="sd">        concat_direction (string): &#39;horiz&#39; or &#39;vert&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_data_df_sorted (pandas df)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;horiz&quot;</span><span class="p">:</span>
        <span class="c1"># Concatenate the data_dfs horizontally</span>
        <span class="n">all_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Sanity check: the number of columns in all_data_df should</span>
        <span class="c1"># correspond to the sum of the number of columns in the input dfs</span>
        <span class="n">n_cols</span> <span class="o">=</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;all_data_df.shape[1]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_cols</span><span class="p">))</span>
        <span class="n">n_cols_cumulative</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data_dfs</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">n_cols</span> <span class="o">==</span> <span class="n">n_cols_cumulative</span>

    <span class="k">elif</span> <span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;vert&quot;</span><span class="p">:</span>

        <span class="c1"># Concatenate the data_dfs vertically</span>
        <span class="n">all_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Sanity check: the number of rows in all_data_df should</span>
        <span class="c1"># correspond to the sum of the number of rows in the input dfs</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;all_data_df.shape[0]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_rows</span><span class="p">))</span>
        <span class="n">n_rows_cumulative</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data_dfs</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">n_rows</span> <span class="o">==</span> <span class="n">n_rows_cumulative</span>

    <span class="c1"># Sort both indices</span>
    <span class="n">all_data_df_sorted</span> <span class="o">=</span> <span class="n">all_data_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_data_df_sorted</span></div>


<div class="viewcode-block" id="do_reset_ids"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.do_reset_ids">[docs]</a><span class="k">def</span> <span class="nf">do_reset_ids</span><span class="p">(</span><span class="n">concatenated_meta_df</span><span class="p">,</span> <span class="n">data_df</span><span class="p">,</span> <span class="n">concat_direction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Reset ids in concatenated metadata and data dfs to unique integers and</span>
<span class="sd">    save the old ids in a metadata column.</span>

<span class="sd">    Note that the dataframes are modified in-place.</span>

<span class="sd">    Args:</span>
<span class="sd">        concatenated_meta_df (pandas df)</span>
<span class="sd">        data_df (pandas df)</span>
<span class="sd">        concat_direction (string): &#39;horiz&#39; or &#39;vert&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        None (dfs modified in-place)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;horiz&quot;</span><span class="p">:</span>

        <span class="c1"># Make sure cids agree between data_df and concatenated_meta_df</span>
        <span class="k">assert</span> <span class="n">concatenated_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;cids in concatenated_meta_df do not agree with cids in data_df.&quot;</span><span class="p">)</span>

        <span class="c1"># Reset cids in concatenated_meta_df</span>
        <span class="n">reset_ids_in_meta_df</span><span class="p">(</span><span class="n">concatenated_meta_df</span><span class="p">)</span>

        <span class="c1"># Replace cids in data_df with the new ones from concatenated_meta_df</span>
        <span class="c1"># (just an array of unique integers, zero-indexed)</span>
        <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">concatenated_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">concat_direction</span> <span class="o">==</span> <span class="s2">&quot;vert&quot;</span><span class="p">:</span>

        <span class="c1"># Make sure rids agree between data_df and concatenated_meta_df</span>
        <span class="k">assert</span> <span class="n">concatenated_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">data_df</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="p">(</span>
            <span class="s2">&quot;rids in concatenated_meta_df do not agree with rids in data_df.&quot;</span><span class="p">)</span>

        <span class="c1"># Reset rids in concatenated_meta_df</span>
        <span class="n">reset_ids_in_meta_df</span><span class="p">(</span><span class="n">concatenated_meta_df</span><span class="p">)</span>

        <span class="c1"># Replace rids in data_df with the new ones from concatenated_meta_df</span>
        <span class="c1"># (just an array of unique integers, zero-indexed)</span>
        <span class="n">data_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">concatenated_meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="reset_ids_in_meta_df"><a class="viewcode-back" href="../../../pandasGEXpress.html#cmapPy.pandasGEXpress.concat_gctoo.reset_ids_in_meta_df">[docs]</a><span class="k">def</span> <span class="nf">reset_ids_in_meta_df</span><span class="p">(</span><span class="n">meta_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Meta_df is modified inplace. &quot;&quot;&quot;</span>

    <span class="c1"># Record original index name, and then change it so that the column that it</span>
    <span class="c1"># becomes will be appropriately named</span>
    <span class="n">original_index_name</span> <span class="o">=</span> <span class="n">meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
    <span class="n">meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;old_id&quot;</span>

    <span class="c1"># Reset index</span>
    <span class="n">meta_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Change the index name back to what it was</span>
    <span class="n">meta_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">original_index_name</span></div>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">build_parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">setup_logger</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Connectivity Map at Broad Institute of MIT and Harvard, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>